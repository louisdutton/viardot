var e=Object.defineProperty,t=(t,s,i)=>(((t,s,i)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i})(t,"symbol"!=typeof s?s+"":s,i),i);import{q as s,C as i,R as n,r as a,u as r,G as o,a as c,B as h,b as l,V as u,F as m,c as p,d,i as v,e as g}from"./vendor.dd833de9.js";const x={add(e,t){document.addEventListener(e,(e=>t(e.detail)))},dispatch(e,t){document.dispatchEvent(new CustomEvent(e,{detail:t}))},remove(e,t){document.removeEventListener(e,t)}},f=s(i)`
  width: 500px;
  height: 500px;
  background: none;
`,y={zh:"viseme_sil",p:"viseme_PP",f:"viseme_FF",th:"viseme_TH",d:"viseme_DD",k:"viseme_kk",ch:"viseme_CH",s:"viseme_SS",n:"viseme_nn",r:"viseme_RR",aa:"viseme_aa",ah:"viseme_E",iy:"viseme_I",ao:"viseme_O",uw:"viseme_U"};function b(e){const t=r(o,"/assets/viardot.glb").scene,[s,i]=a.exports.useState({head:null,mouth:null}),[m,p]=n.useState(0),{viewport:d}=c(),v=a.exports.useRef(),g=.1;var f,b,E,w,I,M;return a.exports.useEffect((()=>{x.add("setPhoneme",(({phoneme:e})=>p((e=>{var t=y[e];return s.head.morphTargetDictionary[t]})(e))));var e=[],n=[];return t.traverse((function(t){t.morphTargetInfluences&&e.push(t),t instanceof h&&t.name.includes("Eye")&&n.push(t)})),i({head:e[0],mouth:e[1],eyes:n}),()=>x.remove("setPhoneme")}),[]),l((({mouse:e})=>{f=e.x*d.width/2,b=e.y*d.height/2,I=v.current.rotation,E=-b/3,w=f/2,M=new u(.9*I.x+E*g,.9*I.y+w*g,0),v.current.rotation.set(M.x,M.y,M.z),s.eyes[0].rotation.x=-Math.PI/2.2+Math.PI/1.5*E,s.eyes[0].rotation.z=Math.PI+Math.PI/1.5*w,s.eyes[1].rotation.x=-Math.PI/2.2+Math.PI/1.5*E,s.eyes[1].rotation.z=Math.PI+Math.PI/1.5*w})),n.createElement("primitive",{object:t,ref:v,position:[0,-.6,0]})}function E(e){return n.createElement(f,{style:{width:"500px",height:"500px"},dpr:window.devicePixelRatio,camera:{aspectRatio:1,fov:30,position:[0,0,1.2]}},n.createElement("ambientLight",{intensity:.2}),n.createElement("pointLight",{position:[-5,2,-7],intensity:2,color:"magenta"}),n.createElement("pointLight",{position:[5,5,-5],intensity:2,color:"cyan"}),n.createElement("pointLight",{position:[5,4,5],intensity:1}),n.createElement(a.exports.Suspense,{fallback:null},n.createElement(b,{voice:e.voice})))}class w extends AudioWorkletNode{constructor(e){super(e,"noise-modulator",{numberOfInputs:1,numberOfOutputs:2}),this.tenseness=this.parameters.get("tenseness"),this.intensity=this.parameters.get("intensity"),this.floor=this.parameters.get("floor")}}class I extends AudioWorkletNode{constructor(e){super(e,"glottis",{channelCount:1,numberOfInputs:0,numberOfOutputs:1}),this.frequency=this.parameters.get("frequency"),this.tenseness=this.parameters.get("tenseness"),this.intensity=this.parameters.get("intensity"),this.loudness=this.parameters.get("loudness"),this.vibratoRate=this.parameters.get("vibratoRate"),this.vibratoDepth=this.parameters.get("vibratoRate")}}class M extends AudioWorkletNode{constructor(e){super(e,"aspirator",{numberOfInputs:1}),this.tenseness=this.parameters.get("tenseness"),this.intensity=this.parameters.get("intensity")}}class k extends AudioWorkletNode{constructor(e){super(e,"tract",{numberOfInputs:2}),this.intensity=this.parameters.get("intensity"),this.tenseness=this.parameters.get("tenseness"),this.tongueIndex=this.parameters.get("tongueIndex"),this.tongueDiameter=this.parameters.get("tongueDiameter"),this.tipIndex=this.parameters.get("tipIndex"),this.tipDiameter=this.parameters.get("tipDiameter")}}const P={aa:[.84,.73],ah:[.84,.55],ae:[35.93,2.6],uh:[33.8,2],ao:[.79,.76],ax:[30.7,2.1],oh:[5.7,2],uw:[2.8,2.1],ih:[24.8,2.6],iy:[.72,.22],sh:[33.98,.5],zh:[34.7,.65],s:[37.8,.5],z:[38,.75],f:[41,.6],v:[41,.6],g:[20,0],k:[25,0],d:[36,0],t:[37,0],b:[41,0],p:[42,0],ng:[20,-1],n:[36,-1],m:[41,-1]};class O{constructor(e){t(this,"recieve",(e=>{console.log(e)})),window.AudioContext=window.AudioContext||window.webkitAudioContext,this.ctx=new window.AudioContext,this.ctx.suspend(),this.sampleRate=this.ctx.sampleRate,console.log("[viardot] Initializing...");var s=this.ctx.audioWorklet;Promise.all([s.addModule("src/viardot/worklets/tract.js"),s.addModule("src/viardot/worklets/noise-modulator.js"),s.addModule("src/viardot/worklets/aspirator.js"),s.addModule("src/viardot/worklets/glottis.js")]).then((()=>this.init())).then((()=>this.onComplete(e)))}onComplete(e){console.log("[viardot] Intialization complete."),e()}init(){this.master=this.ctx.createGain(),this.master.gain.setValueAtTime(.05,this.ctx.currentTime),this.master.connect(this.ctx.destination),this.reverb=new m(this.ctx),this.reverb.roomSize=.7,this.reverb.dampening=3e3,this.reverb.wet.value=.15,this.reverb.dry.value=.85,this.reverb.connect(this.master),this.tractData=[],this.tract=new k(this.ctx),this.tract.connect(this.reverb),setInterval((()=>this.tract.port.postMessage(0)),100),this.glottalSource=this.ctx.createGain(),this.glottalSource.connect(this.tract),this.glottalExcitation=new I(this.ctx),this.glottalExcitation.connect(this.glottalSource),this.initNoise(2)}setNasal(e){this.tract.port.postMessage(e)}setVowel(e){}setFrequency(e){this.noiseLFO.frequency.value=e,this.glottalExcitation.frequency.value=e}setIntensity(e){var t=.3*e;this.glottalExcitation.tenseness.value=t/2,this.glottalExcitation.loudness.value=Math.pow(e,.25),this.glottalExcitation.intensity.value=.2*e,this.aspirator.tenseness.value=t,this.aspirator.intensity.value=e,this.noiseModulator.tenseness.value=t,this.noiseModulator.intensity.value=e}initNoise(e){this.aspirationGain=this.ctx.createGain(),this.aspirationGain.connect(this.reverb),this.aspirator=new M(this.ctx),this.aspirator.connect(this.aspirationGain),this.noise=this.ctx.createBufferSource(),this.noise.buffer=this.createPinkNoise(e,this.sampleRate),this.noise.loop=!0,this.noise.start(),this.noiseModulator=new w(this.ctx),this.noiseModulator.connect(this.aspirationGain.gain),this.noiseLFO=this.createLFO(220,this.noiseModulator),this.noiseLFO.start(),this.fricativeGain=this.ctx.createGain(),this.fricativeGain.connect(this.tract,0,1),this.noiseModulator.connect(this.fricativeGain.gain),this.aspirationFilter=this.createFilter(500,.6).connect(this.aspirator),this.fricativeFilter=this.createFilter(1e3,.7).connect(this.fricativeGain)}createLFO(e,t){var s=this.ctx.createOscillator();return s.frequency.value=e,s.connect(t),s}createFilter(e,t=.67){var s=this.ctx.createBiquadFilter();return s.type="bandpass",s.frequency.value=e,s.Q.value=t,this.noise.connect(s),s}createPinkNoise(e,t){for(var s=e*t,i=this.ctx.createBuffer(1,s,t),n=i.getChannelData(0),a=0;a<s;a++)n[a]=2*Math.random()-1,n[a]*=.11;return i}setPhoneme(e){var t=P[e],s={name:e,index:t[0],diameter:t[1]};this.setTongue(s.index,s.diameter)}setTongue(e,t,s=.3){this.tract.tongueIndex.value=e,this.tract.tongueDiameter.value=t}setIndex(e,t=.3){this.tract.tongueIndex.value=e}setDiameter(e,t=.3){this.tract.tongueDiameter.value=e}getIntensity(){return this.glottalExcitation.tenseness.value}start(){this.ctx.resume(),this.tract.connect(this.reverb)}stop(){this.tract.disconnect(this.reverb)}}t(O,"getPhonemeDict",(()=>P));const F=s.div`
  position: absolute;
  height: 40px;
  width: 40px;
  left: 5%;
  top: 5%;
`,D=s.input`
  position: absolute;
  left: 50%;
  bottom: 5%;
  transform: translateX(-50%);
  border-radius: 25px;
  background-color: black;
  opacity: 50%;
  height: 40px;
`,_=s.p`
  position: absolute;
  left: 50%;
  bottom: 10%;
  transform: translateX(-50%);
  background: none;
  color: white;
`,C=s.select`
  position: absolute;
  right: 5%;
  bottom: 15%;
  width: 40px;
  background: none;
  color: white;
`;function S(e){return n.createElement("div",{className:"fade-in"},n.createElement(F,null,n.createElement("button",{onClick:()=>console.log("test")},n.createElement(p,null))),n.createElement(G,{voice:e.voice}),n.createElement(N,{voice:e.voice}))}function G(e){const[t,s]=a.exports.useState({ipa:"ipa"});return n.createElement("div",{className:"Input"},n.createElement(D,{onChange:e=>{var t=d.exports.phones(e.target.value);s({ipa:t})},placeholder:"Enter text"}),n.createElement(_,null,t.ipa))}function N(e){const t=Object.keys(P).map((e=>n.createElement("option",{key:e,value:e},e)));return n.createElement(C,{onChange:t=>{x.dispatch("setPhoneme",{phoneme:t.target.value}),e.voice.setPhoneme(t.target.value)}},t)}function R(){const[e,t]=a.exports.useState(null),[s,i]=a.exports.useState(!1);if(a.exports.useEffect((()=>{t(new O((e=>i(!0))))}),[]),!s)return null;return n.createElement("div",{className:"App",onMouseMove:t=>{var s=t.screenX/window.innerWidth,i=440+440*(1-t.screenY/window.innerHeight);e.setFrequency(i),e.setIntensity(s)},onMouseDown:()=>e.start(),onMouseUp:()=>e.stop()},n.createElement(L,null),n.createElement(E,{voice:e}),n.createElement(S,{voice:e}))}const L=()=>n.createElement("h1",null,n.createElement(v,{easing:"easeInOutElastic",duration:2250,delay:(e,t)=>100*(t+1),scale:[.5,1],opacity:[0,1]},"Viardot".split("").map((function(e,t){return n.createElement("div",{key:t},e)}))));g.render(n.createElement(n.StrictMode,null,n.createElement(R,null)),document.getElementById("root"));
